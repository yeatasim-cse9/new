<!-- frontend/partials/header-user.html -->
<link
  rel="stylesheet"
  href="/restaurant-app/frontend/assets/vendor/bootstrap/bootstrap.min.css"
/>

<style>
  :root {
    --brand: #dc3545;
    --ink: #222;
    --muted: #6c757d;
    --line: #eef1f4;
  }
  .navbar {
    box-shadow: 0 4px 18px rgba(0, 0, 0, 0.05);
    border-bottom: 1px solid var(--line);
  }
  .navbar-brand .logo-badge {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    background: var(--brand);
    color: #fff;
    display: grid;
    place-items: center;
    font-weight: 700;
    margin-right: 0.55rem;
  }
  .nav-link {
    color: #3a3a3a;
  }
  .nav-link:hover,
  .nav-link.active {
    color: var(--brand);
  }
  .btn-quiet {
    border: 1px solid var(--line);
    background: #fff;
    color: #333;
  }
  .btn-quiet:hover {
    background: #fafbfc;
  }
  .avatar-badge {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background: rgba(220, 53, 69, 0.12);
    color: var(--brand);
    display: grid;
    place-items: center;
    font-weight: 700;
  }
</style>

<header class="sticky-top bg-white">
  <nav class="navbar navbar-expand-lg bg-white">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" id="brandLink" href="#">
        <span class="logo-badge">CR</span>
        <span>The Cafe Rio — Gulshan</span>
      </a>

      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#mainNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="navLeft">
          <li class="nav-item">
            <a class="nav-link" data-href="/index.php">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/index.php#menu">Menu</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/reservations.php"
              >Reservations</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/order.php"
              >Order Online</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/reviews.php"
              >Reviews</a
            >
          </li>
        </ul>

        <div class="d-flex gap-2 js-auth-guest">
          <a class="btn btn-quiet" id="loginLink"
            ><i class="bi bi-box-arrow-in-right me-1"></i> Login</a
          >
          <a class="btn btn-danger" id="registerLink"
            ><i class="bi bi-person-plus me-1"></i> Register</a
          >
        </div>

        <div class="js-auth-user dropdown d-none">
          <button
            class="btn btn-quiet d-flex align-items-center gap-2 dropdown-toggle"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <span class="avatar-badge">U</span>
            <div class="text-start">
              <div id="navUserName" class="small fw-semibold">Account</div>
              <div
                id="navUserEmail"
                class="small text-muted"
                style="line-height: 1"
              >
                —
              </div>
            </div>
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li class="dropdown-header small text-muted">Account</li>
            <li>
              <a class="dropdown-item" id="profileLink"
                ><i class="bi bi-person-circle me-2"></i> Profile</a
              >
            </li>
            <li>
              <a class="dropdown-item" id="myResvLink"
                ><i class="bi bi-calendar2-check me-2"></i> My Reservations</a
              >
            </li>
            <li>
              <a class="dropdown-item" id="myReviewsLink"
                ><i class="bi bi-star-half me-2"></i> My Reviews</a
              >
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <button id="btnLogout" class="dropdown-item text-danger">
                <i class="bi bi-box-arrow-right me-2"></i> Logout
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  (function () {
    if (!window.APP_BASE) {
      var p = location.pathname.split("/");
      var i = p.indexOf("restaurant-app");
      window.APP_BASE = i >= 0 ? "/" + p.slice(1, i + 1).join("/") : "";
    }
  })();
  function href(el, path) {
    if (el) el.href = window.APP_BASE + path;
  }
  function getUser() {
    try {
      return JSON.parse(localStorage.getItem("cr_user") || "null");
    } catch {
      return null;
    }
  }

  (function wireNav() {
    href(document.getElementById("brandLink"), "/index.php");
    document
      .querySelectorAll("#navLeft a[data-href]")
      .forEach((a) => href(a, a.getAttribute("data-href")));
    href(document.getElementById("loginLink"), "/frontend/pages/login.php");
    href(
      document.getElementById("registerLink"),
      "/frontend/pages/register.php"
    );

    var u = getUser(),
      guest = document.querySelector(".js-auth-guest"),
      logged = document.querySelector(".js-auth-user");
    if (u && u.user_id) {
      guest.classList.add("d-none");
      logged.classList.remove("d-none");
      document.getElementById("navUserName").textContent =
        u.name || "User #" + u.user_id;
      document.getElementById("navUserEmail").textContent = u.email || "";
      var badge = document.querySelector(".avatar-badge");
      if (badge)
        badge.textContent =
          (u.name || "U").trim().charAt(0).toUpperCase() || "U";
      href(
        document.getElementById("profileLink"),
        "/frontend/pages/profile.php"
      );
      href(
        document.getElementById("myResvLink"),
        "/frontend/pages/reservations.php"
      );
      href(
        document.getElementById("myReviewsLink"),
        "/frontend/pages/reviews.php"
      );
    } else {
      logged.classList.add("d-none");
      guest.classList.remove("d-none");
    }

    var path = location.pathname.replace(/\/+$/, "");
    document.querySelectorAll("#navLeft .nav-link").forEach((a) => {
      var hp = (a.getAttribute("href") || "")
        .replace(/#.*$/, "")
        .replace(/\/+$/, "");
      a.classList.toggle(
        "active",
        hp === path ||
          (hp.endsWith("/index.php") && path.endsWith("/index.php"))
      );
    });

    var btnLogout = document.getElementById("btnLogout");
    if (btnLogout) {
      btnLogout.addEventListener("click", () => {
        localStorage.removeItem("cr_user");
        location.href = window.APP_BASE + "/index.php";
      });
    }
  })();
</script>
